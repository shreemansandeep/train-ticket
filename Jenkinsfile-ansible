pipeline{
  agent any
  
  environment {
      DOCKER_TAG = getVersion()
    }

    stages{
    
      stage("Git Checkout"){
        steps{
              git credentialsId: 'GitCred', url: 'https://github.com/shreemansandeep/Train-Ticket-Reservation-System.git'
        }
      }
      
      stage("Maven Build"){
      steps{
          sh "mvn clean install"
        }
      }
      
      stage("Docker Build image and Tag"){
            steps{
                  sh 'docker image build -t $JOB_NAME:$(DOCKER_TAG) .'
                  sh 'docker image tag $JOB_NAME:$(DOCKER_TAG) dockersandheep/$JOB_NAME:$(DOCKER_TAG)'
                  // sh 'docker image tag $JOB_NAME:$(DOCKER_TAG) dockersandheep/$JOB_NAME:latest'
              }
            }
      
   }
 }
 
 def getVersion(){
 def commitHash = sh returnStdout: true, script: 'git rev-parse --short HEAD'
 return commitHash
 }
