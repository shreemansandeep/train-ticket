pipeline{
agent any
environment {
        registry = "436312201622.dkr.ecr.ap-south-1.amazonaws.com/trainticket-ecr"
    }

  stages{

    stage("Git Checkout"){
      steps{            
              git credentialsId: 'GitHubCreD', url: 'https://github.com/shreemansandeep/Train-Ticket-Reservation-System.git'
              }
           }
           
     
       stage("Maven Build"){
        steps{
              sh 'mvn clean install'
            }
          }   
          
          stage ("Build image") {
            steps {
                script {
                    docker.build registry
                }
            }
        }
            
     stage ("Push to ECR") {
            steps {
                sh "aws ecr get-login-password --region ap-south-1 | docker login --username AWS --password-stdin 436312201622.dkr.ecr.ap-south-1.amazonaws.com"
                sh "docker push 436312201622.dkr.ecr.ap-south-1.amazonaws.com/trainticket-ecr:latest"
                
            }
        }
            /*
            stage("k8s Deploy"){
              steps{
                  script{
                        kubernetesDeploy (configs: 'k8s-ttdepsvc.yml', kubeconfigId: 'k8sconfig-deploy')
                  }
              }
           }
          */

        }
    }
